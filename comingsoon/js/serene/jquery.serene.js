(function(a,s){function t(){a.each(arguments,function(a,c){if(typeof u[c]==="undefined")u[c]=document.createElement("img"),u[c].src=j.eq(c).attr("href")})}function k(c,b){b&&typeof b==="function"&&b.call();a.event.trigger(c)}function J(){v=a('<div class="serene-outer"></div>').append(w=a('<div class="serene-overlay"></div>'),g=a('<div class="serene-stage"></div>'),n=a('<div class="serene-controls-outer"></div>').append(F=a('<div class="serene-controls"></div>').append(x=a('<div class="serene-prev"></div>'),
o=a('<div class="serene-play"></div>'),p=a('<div class="serene-next"></div>')),y=a('<div class="serene-loading-wrap"></div>').append(a('<div class="serene-loading"></div>')),G=a('<div class="serene-close-wrap"></div>').append(a('<div class="serene-close"></div>'))));a("body").append(v);p.click(function(){if(l)return!1;else e.next()});x.click(function(){if(l)return!1;else e.prev()});G.click(e.close);a("body").append(v);H=a("body").css("overflow");a(".serene-element").live("click",function(b){b.preventDefault();
k(K,c.onOpen);w.css("opacity",c.opacity).add(g).show();a("body").css("overflow","hidden");q=!0;L(a(this))});z.resize(I)}function L(i){j=i;var d=i.attr("rel");d&&(j=a(".serene-element").filter(function(){return this.rel===d}),b=j.index(i));f=j.length;if(f>1&&(F.show(),g.click(function(){p.click()}).css("cursor","pointer"),c.keyboard&&a(document).bind("keydown.serene",function(a){q&&a.keyCode===27&&(a.preventDefault(),e.close());q&&!l&&f>1&&(a.keyCode===37?(a.preventDefault(),x.click()):a.keyCode===
39&&(a.preventDefault(),p.click()))}),c.slideshow)){var h,A,B;A=function(){o.bind(C,function(){h=setTimeout(e.next,c.slideshowSpeed)}).bind(m,function(){clearTimeout(h)}).removeClass("serene-play").addClass("serene-pause").unbind("click").one("click "+D,B);h=setTimeout(e.next,c.slideshowSpeed)};B=function(){clearTimeout(h);o.unbind([C,m,D,"click"].join(" ")).removeClass("serene-pause").addClass("serene-play").one("click",A)};c.slideshowAuto?A():B();o.show()}n.bind(m,function(){n.fadeIn(0).unbind(m)});
E(function(){c.preload&&t(b==f-1?0:b+1,b==0?f-1:b-1)})}function E(i){var e=document.createElement("img"),h;d=a(e).css("position","fixed");d.load(function(){d.unbind("load");setTimeout(function(){r=e.height/e.width;var a=g.find("img");g.append(d);I(function(){clearTimeout(h);y.hide();var b=function(){d.animate({opacity:"show"},{duration:c.speedIn,complete:function(){l=!1;k(C,c.onComplete);typeof i==="function"&&i.call()}})};a.length?(a.animate({opacity:"hide"},{duration:c.speedOut,complete:function(){c.sync||
b();a.remove()}}),c.sync&&b()):b()})},1)});h=setTimeout(function(){y.fadeIn()},200);k(m,c.onLoad);l=!0;setTimeout(function(){d.attr("src",j.eq(b).attr("href"))},1)}function I(a){if(d){var c=z.width(),b=z.height();b/c>r?d.height(b).width(b/r):d.width(c).height(c*r);d.css({left:(c-d.width())/2+"px",top:(b-d.height())/2+"px"});typeof a==="function"&&a.call()}}var M={speedIn:3E3,speedOut:3E3,sync:!0,preload:!0,slideshow:!0,slideshowAuto:!0,slideshowSpeed:7E3,keyboard:!0,onOpen:!1,onLoad:!1,onComplete:!1,
onCleanup:!1,onClose:!1},v,w,g,n,F,x,o,p,y,G,d,j,z=a(s),K="sereneOpen",m="sereneLoad",C="sereneComplete",D="sereneCleanup",u=[],r,H,b=0,f,l=!1,q=!1,c,e;e=a.fn.serene=function(b){if(!this[0]&&this.selector)return this;c=a.extend({},M,b||{});return this.each(function(){a(this).addClass("serene-element")})};e.close=function(){k(D,c.onCleanup);a("body").css("overflow",H);w.add(g).add(n).hide();var b=g.find("img");b.length>0&&b.remove();q=!1;c.keyboard&&a(document).unbind("keydown.serene");k("sereneClose",
c.onClose)};e.next=function(){b=b==f-1?0:b+1;E(function(){c.preload&&t(b==f-1?0:b+1)})};e.prev=function(){b=b==0?f-1:b-1;E(function(){c.preload&&t(b==0?f-1:b-1)})};a(document).ready(function(){J();typeof s.preload==="function"&&s.preload(["js/serene/images/backward.png","js/serene/images/backward1.png","js/serene/images/play.png","js/serene/images/play1.png","js/serene/images/pause.png","js/serene/images/pause1.png","js/serene/images/close.png","js/serene/images/close1.png","js/serene/images/forward.png",
"js/serene/images/forward1.png","js/serene/images/opacity-80-rep.png"])})})(jQuery,window);